################################################################################
import movies
import tmdb

################################################################################
THEPIRATEBAY        = 'http://thepiratebay.se'
THEPIRATEBAY_SEARCH = THEPIRATEBAY + '/search/{0}/{1}/7/200'
THEPIRATEBAY_TOP    = THEPIRATEBAY + '/top/{0}'

################################################################################
def MetadataObjectForURL(url):
	html             = HTML.ElementFromURL(url, cacheTime=CACHE_1DAY)
	torrent_title    = html.xpath('//*[@id="title"]')[0].text.strip()
	torrent_release  = movies.get_torrent_release(torrent_title)
	torrent_seeders  = html.xpath('//*[@id="details"]/dl[1]/dd[9]/text()')[0].strip()
	torrent_leechers = html.xpath('//*[@id="details"]/dl[1]/dd[10]/text()')[0].strip()

	metadata_object       = MovieObject()
	metadata_object.title = torrent_title

	movie_info = movies.get_movie_info(metadata_object.title)
	if movie_info['tmdb_id']:
		tmdb.fill_metadata_object(metadata_object, movie_info['tmdb_id'])
	
	metadata_object.summary = '{0}\nSeeders: {1}, Leechers: {2}\n\n{3}'.format(torrent_release, torrent_seeders, torrent_leechers, metadata_object.summary)

	return metadata_object

################################################################################
def MediaObjectsForURL(url, play_func):
	html   = HTML.ElementFromURL(url, cacheTime=CACHE_1DAY)
	magnet = html.xpath('//*[@id="details"]/div[@class="download"]/a[1]/@href')[0]

	media_objects = []

	media_object = MediaObject()
	media_object.add(PartObject(key=Callback(play_func, url=url, magnet=magnet)))
	media_objects.append(media_object)

	return media_objects
